# エックスサーバー(Xserver)へのデプロイ手順

このドキュメントでは、エックスサーバーにTic-Tac-Toeアプリケーションをデプロイする方法を説明します。

## 前提条件

- エックスサーバーのアカウントを持っていること
- FTPクライアント（FileZilla、Cyberduckなど）がインストールされていること
- または、エックスサーバーのファイルマネージャーを使用可能

## デプロイ手順

### 1. ファイルの準備

リポジトリの `public` ディレクトリ内のすべてのファイルをアップロードします。

```
public/
├── .htaccess          ← Xserver用設定ファイル
├── php.ini            ← PHP設定ファイル
├── index.php          ← メインルーター
├── health.php
├── rules.php
├── tictactoe.php
├── othello.php
└── assets/
    ├── css/
    └── js/
```

### 2. FTPでファイルをアップロード

#### 方法1: FTPクライアントを使用

1. FTPクライアントを起動
2. エックスサーバーのFTP情報を入力：
   - **ホスト**: `sv******.xserver.jp` （サーバーパネルで確認）
   - **ユーザー名**: サーバーIDまたはFTPアカウント
   - **パスワード**: FTPパスワード
   - **ポート**: 21

3. 接続後、`public_html` または `ドメイン名` のフォルダに移動

4. `public` ディレクトリの内容を**すべて**アップロード
   - ⚠️ **重要**: `public` フォルダ自体ではなく、その**中身**をアップロードしてください

#### 方法2: エックスサーバーのファイルマネージャーを使用

1. サーバーパネルにログイン
2. 「ファイルマネージャ」をクリック
3. 対象のドメインフォルダに移動
4. 「アップロード」から `public` ディレクトリの内容をアップロード

### 3. PHPバージョンの確認・設定

1. サーバーパネルにログイン
2. 「PHP Ver.切替」をクリック
3. 対象ドメインを選択
4. **PHP 7.4以上**を選択（推奨: PHP 8.0以上）
5. 「変更」をクリック

### 4. 動作確認

アップロードが完了したら、ブラウザで以下のURLにアクセスして動作を確認します：

- **トップページ**: `https://あなたのドメイン.com/`
- **ヘルスチェック**: `https://あなたのドメイン.com/health`
- **マルバツゲーム**: `https://あなたのドメイン.com/tictactoe`
- **オセロ**: `https://あなたのドメイン.com/othello`

### 5. HTTPSの有効化（推奨）

1. サーバーパネルにログイン
2. 「SSL設定」をクリック
3. 対象ドメインを選択
4. 「無料独自SSL設定」で「追加する」をクリック
5. HTTPSが有効になったら、`.htaccess` の以下の行のコメントを外してHTTPSリダイレクトを有効化：

```apache
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
```

↓

```apache
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
```

## トラブルシューティング

### 問題: 「500 Internal Server Error」が表示される

**対処法**:
1. `.htaccess` の記述に誤りがないか確認
2. `php.ini` の設定値を確認（エックスサーバーの制限内か）
3. ファイルのパーミッション（権限）を確認：
   - ディレクトリ: `755`
   - ファイル: `644`

### 問題: CSSやJavaScriptが読み込まれない

**対処法**:
1. `assets` フォルダが正しくアップロードされているか確認
2. ブラウザのデベロッパーツールでネットワークタブを確認
3. パスが正しいか確認（絶対パスで `/assets/...` を使用）

### 問題: ルーティングが動作しない

**対処法**:
1. `.htaccess` ファイルが `public_html` 直下に配置されているか確認
2. エックスサーバーでmod_rewriteが有効か確認（通常は有効）
3. DirectoryIndexが正しく設定されているか確認

### 問題: PHPエラーが表示されない

**対処法**:
1. `php.ini` で `display_errors = 1` に変更（開発時のみ）
2. エラーログを確認：サーバーパネル →「エラーログ」

## サポート情報

- **エックスサーバー サポート**: https://www.xserver.ne.jp/support/
- **マニュアル**: https://www.xserver.ne.jp/manual/

## セキュリティに関する注意事項

- 本番環境では `php.ini` の `display_errors = 0` を維持してください
- 定期的にPHPバージョンを更新してください
- エックスサーバーのセキュリティ機能（WAF、国外IPアクセス制限など）を活用してください

## 更新手順

アプリケーションを更新する場合：

1. 変更したファイルのみをFTPでアップロード
2. キャッシュをクリア（必要に応じて）
3. 動作確認

---

何か問題が発生した場合は、エックスサーバーのサポートにお問い合わせください。
